<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="DriftHaven - An epic idle RPG adventure">
  <meta name="theme-color" content="#1e1b4b">
  <title>‚öîÔ∏è DriftHaven</title>
  
  <!-- PWA Support -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="DriftHaven">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      overscroll-behavior: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    * {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    
    input, textarea {
      -webkit-user-select: text;
      user-select: text;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, createElement } = React;

    // Lucide icons as SVG components
    const Home = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
    );

    const Star = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
      </svg>
    );

    const Package = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
    );

    const Swords = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"></polyline>
        <line x1="13" y1="19" x2="19" y2="13"></line>
        <line x1="16" y1="16" x2="20" y2="20"></line>
        <line x1="19" y1="21" x2="21" y2="19"></line>
        <polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5"></polyline>
        <line x1="5" y1="14" x2="9" y2="18"></line>
        <line x1="7" y1="17" x2="4" y2="20"></line>
        <line x1="3" y1="19" x2="5" y2="21"></line>
      </svg>
    );

    const Pickaxe = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M14.531 12.469 6.619 20.38a1 1 0 1 1-3-3l7.912-7.912"></path>
        <path d="M15.686 4.314A12.5 12.5 0 0 0 5.461 2.958 1 1 0 0 0 5.58 4.71a22 22 0 0 1 6.318 3.393"></path>
        <path d="m17.7 3.7 1.8 1.8"></path>
        <path d="M19.5 7.5 16 11"></path>
      </svg>
    );

    const Axe = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="m14 12-8.5 8.5a2.12 2.12 0 1 1-3-3L11 9"></path>
        <path d="M15 13 9 7l4-4 6 6h3a8 8 0 0 1-7 7z"></path>
      </svg>
    );

    const Fish = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z"></path>
        <path d="M18 12v.5"></path>
        <path d="M16 17.93a9.77 9.77 0 0 1 0-11.86"></path>
        <path d="M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33"></path>
        <path d="M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4"></path>
        <path d="m16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98"></path>
      </svg>
    );

    const ChefHat = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"></path>
        <line x1="6" y1="17" x2="18" y2="17"></line>
      </svg>
    );

    const Hammer = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"></path>
        <path d="M17.64 15 22 10.64"></path>
        <path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25v-.86L16.01 4.6a5.56 5.56 0 0 0-3.94-1.64H9l.92.82A6.18 6.18 0 0 1 12 8.4v1.56l2 2h2.47l2.26 1.91"></path>
      </svg>
    );

    const Square = ({size = 24, className = "", fill = "none"}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      </svg>
    );

    // Game Logic
    const ACTIVITIES = {
      combat: { name: 'Combat', icon: Swords, xp: 10, gold: 5, skill: 'combat', drops: [{ name: 'Leather', chance: 0.03, value: 15 }] },
      mining: { name: 'Mining', icon: Pickaxe, xp: 5, gold: 2, skill: 'mining', drops: [{ name: 'Iron Ore', chance: 0.05, value: 10 }] },
      woodcutting: { name: 'Woodcutting', icon: Axe, xp: 4, gold: 1, skill: 'woodcutting', drops: [{ name: 'Oak Log', chance: 0.05, value: 8 }] },
      fishing: { name: 'Fishing', icon: Fish, xp: 3.5, gold: 1.5, skill: 'fishing', drops: [{ name: 'Raw Fish', chance: 0.06, value: 5 }] },
      cooking: { name: 'Cooking', icon: ChefHat, xp: 3, gold: 0, skill: 'cooking', drops: [] },
      crafting: { name: 'Crafting', icon: Hammer, xp: 6, gold: 0, skill: 'crafting', drops: [] }
    };

    const DEFAULT_SKILLS = [
      { id: 'combat', name: 'Combat', level: 1, xp: 0, icon: '‚öîÔ∏è' },
      { id: 'mining', name: 'Mining', level: 1, xp: 0, icon: '‚õèÔ∏è' },
      { id: 'woodcutting', name: 'Woodcutting', level: 1, xp: 0, icon: 'ü™ì' },
      { id: 'fishing', name: 'Fishing', level: 1, xp: 0, icon: 'üé£' },
      { id: 'cooking', name: 'Cooking', level: 1, xp: 0, icon: 'üç≥' },
      { id: 'crafting', name: 'Crafting', level: 1, xp: 0, icon: 'üî®' }
    ];

    const xpForLevel = (level) => level * 100 + Math.pow(level, 2) * 50;

    const DriftHaven = () => {
      const [player, setPlayer] = useState(() => {
        const saved = localStorage.getItem('drifthavenPlayer');
        if (saved) {
          const parsed = JSON.parse(saved);
          const offlineTime = Date.now() - (parsed.lastSave || Date.now());
          return calculateOfflineProgress(parsed, offlineTime);
        }
        return {
          name: 'Hero',
          level: 1,
          xp: 0,
          gold: 0,
          skills: DEFAULT_SKILLS,
          inventory: [],
          currentActivity: null,
          activityStartTime: null,
          lastSave: Date.now()
        };
      });

      const [tab, setTab] = useState('dashboard');
      const gameLoopRef = useRef(null);

      useEffect(() => {
        gameLoopRef.current = setInterval(() => {
          if (player.currentActivity) {
            setPlayer(prev => progressActivity(prev));
          }
        }, 100);

        return () => clearInterval(gameLoopRef.current);
      }, [player.currentActivity]);

      useEffect(() => {
        const saveInterval = setInterval(() => {
          const toSave = { ...player, lastSave: Date.now() };
          localStorage.setItem('drifthavenPlayer', JSON.stringify(toSave));
        }, 5000);

        return () => clearInterval(saveInterval);
      }, [player]);

      const calculateOfflineProgress = (savedPlayer, offlineMs) => {
        if (!savedPlayer.currentActivity || offlineMs < 1000) return savedPlayer;
        
        const iterations = Math.min(Math.floor(offlineMs / 100), 36000);
        let updated = { ...savedPlayer };
        
        for (let i = 0; i < iterations; i++) {
          updated = progressActivity(updated);
        }
        
        return updated;
      };

      const progressActivity = (p) => {
        const activity = ACTIVITIES[p.currentActivity];
        if (!activity) return p;

        const newPlayer = { ...p };
        const skillIdx = newPlayer.skills.findIndex(s => s.id === activity.skill);
        
        newPlayer.skills[skillIdx].xp += activity.xp * 0.1;
        while (newPlayer.skills[skillIdx].xp >= xpForLevel(newPlayer.skills[skillIdx].level)) {
          newPlayer.skills[skillIdx].xp -= xpForLevel(newPlayer.skills[skillIdx].level);
          newPlayer.skills[skillIdx].level += 1;
        }

        newPlayer.gold += activity.gold * 0.1;

        if (activity.skill === 'combat') {
          newPlayer.xp += 2;
          while (newPlayer.xp >= xpForLevel(newPlayer.level)) {
            newPlayer.xp -= xpForLevel(newPlayer.level);
            newPlayer.level += 1;
          }
        }

        activity.drops.forEach(drop => {
          if (Math.random() < drop.chance) {
            const existing = newPlayer.inventory.find(i => i.name === drop.name);
            if (existing) {
              existing.quantity += 1;
            } else {
              newPlayer.inventory.push({ name: drop.name, quantity: 1, value: drop.value });
            }
          }
        });

        return newPlayer;
      };

      const startActivity = (activityKey) => {
        setPlayer(prev => ({
          ...prev,
          currentActivity: activityKey,
          activityStartTime: Date.now()
        }));
      };

      const stopActivity = () => {
        setPlayer(prev => ({
          ...prev,
          currentActivity: null,
          activityStartTime: null
        }));
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white">
          <div className="max-w-md mx-auto">
            <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-4 shadow-lg">
              <h1 className="text-2xl font-bold text-center">‚öîÔ∏è DriftHaven</h1>
            </div>

            <div className="p-4 pb-20">
              {tab === 'dashboard' && <Dashboard player={player} startActivity={startActivity} stopActivity={stopActivity} />}
              {tab === 'skills' && <Skills player={player} />}
              {tab === 'inventory' && <Inventory player={player} />}
            </div>

            <div className="fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 max-w-md mx-auto">
              <div className="grid grid-cols-3 gap-1 p-2">
                <NavButton icon={Home} label="Home" active={tab === 'dashboard'} onClick={() => setTab('dashboard')} />
                <NavButton icon={Star} label="Skills" active={tab === 'skills'} onClick={() => setTab('skills')} />
                <NavButton icon={Package} label="Inventory" active={tab === 'inventory'} onClick={() => setTab('inventory')} />
              </div>
            </div>
          </div>
        </div>
      );
    };

    const NavButton = ({ icon: Icon, label, active, onClick }) => (
      <button
        onClick={onClick}
        className={`flex flex-col items-center gap-1 p-2 rounded-lg transition-colors ${
          active ? 'bg-purple-600 text-white' : 'text-gray-400 hover:bg-slate-700'
        }`}
      >
        <Icon size={20} />
        <span className="text-xs">{label}</span>
      </button>
    );

    const Dashboard = ({ player, startActivity, stopActivity }) => {
      return (
        <div className="space-y-4">
          <div className="bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl p-4 shadow-lg">
            <h2 className="text-xl font-bold mb-2">{player.name}</h2>
            <div className="space-y-2">
              <div>
                <div className="flex justify-between text-sm mb-1">
                  <span>Level {player.level}</span>
                  <span>{Math.floor(player.xp)} / {xpForLevel(player.level)} XP</span>
                </div>
                <div className="w-full bg-blue-900 rounded-full h-2">
                  <div
                    className="bg-yellow-400 h-2 rounded-full transition-all duration-300"
                    style={{ width: `${(player.xp / xpForLevel(player.level)) * 100}%` }}
                  />
                </div>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-2xl">üí∞ {Math.floor(player.gold)}</span>
              </div>
            </div>
          </div>

          <div className="bg-slate-800 rounded-xl p-4 shadow-lg">
            <h3 className="text-lg font-semibold mb-3">Current Activity</h3>
            {player.currentActivity ? (
              <div className="space-y-3">
                <div className="flex items-center gap-3">
                  {createElement(ACTIVITIES[player.currentActivity].icon, { size: 24, className: 'text-green-400' })}
                  <span className="text-lg">{ACTIVITIES[player.currentActivity].name}</span>
                </div>
                <button
                  onClick={stopActivity}
                  className="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2"
                >
                  <Square size={16} fill="white" />
                  Stop Activity
                </button>
              </div>
            ) : (
              <p className="text-gray-400 text-center py-2">No active task - Choose one below!</p>
            )}
          </div>

          <div className="bg-slate-800 rounded-xl p-4 shadow-lg">
            <h3 className="text-lg font-semibold mb-3">Activities</h3>
            <div className="grid grid-cols-2 gap-3">
              {Object.entries(ACTIVITIES).map(([key, activity]) => {
                const Icon = activity.icon;
                const skill = player.skills.find(s => s.id === activity.skill);
                return (
                  <button
                    key={key}
                    onClick={() => startActivity(key)}
                    disabled={player.currentActivity === key}
                    className={`p-3 rounded-lg transition-all ${
                      player.currentActivity === key
                        ? 'bg-green-600 text-white'
                        : 'bg-slate-700 hover:bg-slate-600 text-white'
                    } disabled:opacity-50`}
                  >
                    <div className="flex flex-col items-center gap-2">
                      <Icon size={24} />
                      <span className="text-sm font-medium">{activity.name}</span>
                      <span className="text-xs text-gray-300">Lvl {skill.level}</span>
                    </div>
                  </button>
                );
              })}
            </div>
          </div>
        </div>
      );
    };

    const Skills = ({ player }) => {
      return (
        <div className="space-y-3">
          <h2 className="text-2xl font-bold mb-4">Skills</h2>
          {player.skills.map(skill => (
            <div key={skill.id} className="bg-slate-800 rounded-xl p-4 shadow-lg">
              <div className="flex items-center gap-3 mb-2">
                <span className="text-3xl">{skill.icon}</span>
                <div className="flex-1">
                  <h3 className="font-semibold text-lg">{skill.name}</h3>
                  <p className="text-sm text-gray-400">Level {skill.level}</p>
                </div>
              </div>
              <div>
                <div className="flex justify-between text-xs text-gray-400 mb-1">
                  <span>{Math.floor(skill.xp)} XP</span>
                  <span>{xpForLevel(skill.level)} XP</span>
                </div>
                <div className="w-full bg-slate-700 rounded-full h-2">
                  <div
                    className="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full transition-all duration-300"
                    style={{ width: `${(skill.xp / xpForLevel(skill.level)) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
      );
    };

    const Inventory = ({ player }) => {
      const totalValue = player.inventory.reduce((sum, item) => sum + (item.value * item.quantity), 0);
      
      return (
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <h2 className="text-2xl font-bold">Inventory</h2>
            <div className="text-sm text-gray-400">
              Total Value: üí∞ {Math.floor(totalValue)}
            </div>
          </div>
          
          {player.inventory.length === 0 ? (
            <div className="bg-slate-800 rounded-xl p-8 text-center text-gray-400">
              <Package size={48} className="mx-auto mb-2 opacity-50" />
              <p>Your inventory is empty</p>
              <p className="text-sm mt-1">Start activities to collect items!</p>
            </div>
          ) : (
            <div className="space-y-2">
              {player.inventory.map((item, idx) => (
                <div key={idx} className="bg-slate-800 rounded-xl p-4 shadow-lg flex justify-between items-center">
                  <div>
                    <h3 className="font-semibold">{item.name}</h3>
                    <p className="text-sm text-gray-400">Value: üí∞ {item.value} each</p>
                  </div>
                  <div className="text-right">
                    <span className="text-xl font-bold">√ó{item.quantity}</span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    };

    // Render app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<DriftHaven />);
  </script>
</body>
</html>
